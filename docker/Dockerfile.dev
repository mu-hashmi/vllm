# Development Dockerfile for vLLM
# Uses official vLLM OpenAI image as base - all dependencies pre-installed
# Build once, use with different branches via VLLM_REPO and VLLM_BRANCH env vars

ARG VLLM_VERSION=latest
FROM vllm/vllm-openai:${VLLM_VERSION}

WORKDIR /workspace

# Install git (needed to clone repos) and other dev tools
RUN apt-get update -y \
    && apt-get install -y --no-install-recommends \
        git \
        curl \
        vim \
    && rm -rf /var/lib/apt/lists/*

# Keep pre-installed vLLM - we'll use VLLM_USE_PRECOMPILED=1 to reuse its compiled binaries

# Copy the install script
COPY docker/install-and-serve.sh /usr/local/bin/install-and-serve.sh
RUN chmod +x /usr/local/bin/install-and-serve.sh

# Explicitly call bash to avoid exec format errors (common when building on macOS)
ENTRYPOINT ["/bin/bash", "/usr/local/bin/install-and-serve.sh"]
